# Импорт и экспорт django

Команды для загрузки и выгрузки данных из бд django приложения 
```python
python manage.py dumpdata shopapp.Product > shopapp-product-fixtures.json

python manage.py dumpdata --format xml shopapp.Product > shopapp-product-fixtures.xml

python manage.py loaddata shopapp-product-fixtures.xml
```

## DRF файлы

Для того чтобы в Rest API сделать возможность загрузки файлов, можно переопределить класс ModelSetView в котором уже
заложены функции CRUD. Нужно добавить новые действия для класса ViewSet, при помощи декоратора action 
```python
from rest_framework.decorators import action

    @action(methods=['get'], detail=False)
    def download_csv(self, request: Request):
        response = HttpResponse(content_type='text/csv')
        filename = "products-export.csv"
        response['Content-Disposition'] = f'attachment; filename={filename}'
        queryset = self.filter_queryset(self.get_queryset())
        fields = [
            'name',
            'description',
            'price',
            'discount'
        ]
        queryset = queryset.only(*fields)
        writer = DictWriter(response, fieldnames=fields)
        writer.writeheader()

        for product in queryset:
            writer.writerow({
                field: getattr(product, field)
                for field in fields
            })

        return response
```

## RSS Лента новостей   
RSS - (rich size summary) этот формат используется для простого распространения информации о новостях и других публикациях
на сайте

Для реализации представления RSS необходимо использовать класс FEED 

```python
class LatestArticlesFeed(Feed):
    title = "Blog articles latest published"
    description = "Updates on changes and addition blog"
    link = reverse_lazy('blogapp:articles')

    def items(self):
        return (
            Articles.objects
            .filter(publish_date__isnull=False)
            .order_by('-publish_date')[:5]
        )

    def item_title(self, item: Articles):
        return item.title

    def item_description(self, item: Articles):
        return item.body[:200]

    def item_link(self, item: Articles):
        return reverse('blogapp:article', kwargs={"pk": item.pk})
```

* Метод *items* - возвращает объект, в данном случае возвращает 5 последних статей
* Метод *item_title* - возвращает заголовок статьи 
* Метод *item_description* - возвращает описание до 200 символов
* Метод *item_link* - возвращает ссылку по которой можно перейти на статью

Также для необходимо в urls указать представление
```python
    path('article/latest/feed/', LatestArticlesFeed(), name='articles-feed'),
```
Ключевым моментом является то, что обязательно наличие метода get_absolute_url, который также используется 
представлением RSS-ленты. Данный метод возвращает абсолютный адрес страницы и без него также будут сыпаться ошибки.
```python
    def get_absolute_url(self):
        return reverse('blogapp:article', kwargs={'pk': self.pk})
```

Для отображения ленты можно использовать специальные расширения в браузере RSS

## Sitemap

В Django есть фреймворк для генерации карты сайта (Sitemap), который позволяет создавать XML-файл, 
содержащий список страниц на сайте, их релевантность и частоту обновления. Этот фреймворк опирается на модуль 
django.contrib.sitemaps

Цель: помочь поисковым роботам индексировать контент, указав, какие страницы важны, и когда они последний раз менялись

**Настройка**
* Добавить модуль django.contrib.sitemaps в список установленных приложений (INSTALLED_APPS) в файле настроек проекта (settings.py).
```python
    SITE_ID = 1


    'django.contrib.sitemaps',
```
* Определить идентификатор сайта (SITE_ID) — по умолчанию используется 1, так как в проекте только один сайт. SITE_ID 
необходим для идентификации ресурса в базе данных. Если не будет добавлен данный параметр, то в админке сайта не 
получится прописать url вашего сайта, для которого делается Sitemap
* Создать классы Sitemap в отдельном файле — они представляют «раздел» записей в карте сайта. 
Например, один класс Sitemap может представлять все записи блога, а другой — все события в календаре событий. 
```python
from django.contrib.sitemaps import Sitemap
from .models import Articles


class BlogSitemap(Sitemap):
    changefreq = 'never'
    priority = 0.5

    def items(self): #возвращает элементы
        return (Articles.objects
                .filter(publish_date__isnull=False)
                .order_by('-publish_date'))

    def lastmod(self, object: Articles):
        return object.pk


```
* Указать ссылку на класс Sitemap в конфигурации URL — это указывает Django создавать карту сайта при обращении клиента
по адресу /sitemap.xml
```python
    path(
        'sitemap.xml',
        sitemap,
        {"sitemaps": sitemaps},
        name="django.contrib.sitemaps.views.sitemap",
    )
```