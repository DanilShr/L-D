# Оптимизация при помощи кэширования
## Кэширование 

Кэш - это высокоскоростной уровень хранения данных временного характера

Кэширование в django используется для ускорения работы системы. кэширование может использоваться на разынх уровнях:
1. Уровень представления
2. Уровень шаблонов
3. Уровень БД

Для применения кэширования в django необходимо настроить кэш бэкэнд - это место где будет хранится данные по кэшу. 
Django пддерживает кэширование в файловой системе на уровне redis и также оперативной памяти

Настройка Кэширования:
в settings.py  
* UpdateCacheMiddleware — класс промежуточного программного обеспечения (middleware) в Django, 
который обновляет кэш ответа после обработки запроса. Это позволяет:
Включить кэширование всего сайта — все GET и HEAD-запросы кэшируются на указанное время.
Включить кэширование только определённых представлений — можно включить кэширование только определённых view, 
которые создают наибольшую нагрузку.
* FetchFromCacheMiddleware — класс промежуточного программного обеспечения (middleware) в Django, 
который извлекает кэшированные ответы и обслуживает их
```python
MIDDLEWARE = [
    'django.middleware.cache.UpdateCacheMiddleware', # указываем обязательно в начале, так ак он запускается при обработке 
    # Response, а следовательно запускается последним при подготовке ответа 
     .....
    'django.middleware.cache.FetchFromCacheMiddleware', # запускается на этапе Requests, поэтому запускается последним 
]

CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.filebased.FileBasedCache', 
        'LOCATION': 'c:/var/temp/django_cache', # путь хранения кэша
    },
} 

CACHE_MIDDLEWARE_SECONDS = 200 #время в секундах сколько будет хранится кэш
```

## Кэширование представлений (view) 
Для кэширование представлений используется декоратор **cache_page**. Он работает независимо то middleware, не мешает их 
работе и не дополняет
```python
@cache_page(60 * 2) #таймаут 2 минуты
```
Декорирование классов view в обычном формате вызовет ошибку, для декорирования классов необходимо передать в декоратор 
класс на моменте его вызова в urls
```python
    path("", cache_page(60 * 3)(ShopIndexView.as_view()), name="index"),
```

Для декорирования методов django rest frameworks необходимо использовать специальный декоратор **method_decoration** из модуля
from _django.utils.decorators import method_decorator_

В данном примере в классе идет переопределение метода для того чтобы его можно было декорировать. Method_decoration 
принимает в себя другой декоратор cache_page с указаными настройками таймаута
```python
    @method_decorator(cache_page(60 * 2))
    def list(self, *args, **kwargs):
        return super().list(*args, **kwargs)
```

## Кэшированние шаблонов
Кэширование шаблонов происходит при помощи тэга cache

```html
{% load cache %}

{% cache anyonetag %}
.....
{% endcache %}
```

## Cache API 
