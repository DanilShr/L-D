{% extends "main/index.html" %}
{% load static %}
{% block first_section %}
<section class="order-block">
    {% if orders %}
        {% for order in orders %}
            <div class="order-view">
                <div class="order-view-inner">
                    <div class="order-info">
                        <p class="order-number">–ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</p>
                        <p class="order-date">{{ order.created_at|date:"d.m.Y H:i" }}</p>
                    </div>
                    <div class="order-summary">
                        <p class="order-total">–ò—Ç–æ–≥–æ: <strong>{{ order.total }} ‚ÇΩ</strong></p>
                        <p class="order-status">–°—Ç–∞—Ç—É—Å: <span class="status-badge">{{ order.status }}</span></p>
                    </div>
                </div>

                <div class="accordion accordion-flush" id="accordionFlush-{{ order.id }}">
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-{{ order.id }}" aria-expanded="false" aria-controls="flush-collapse-{{ order.id }}">
                        üì¶ –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
                      </button>
                    </h2>
                    <div id="flush-collapse-{{ order.id }}" class="accordion-collapse collapse" data-bs-parent="#accordionFlush-{{ order.id }}">
                        <div class="accordion-body">
                            <div class="order-items">
                                {% for item in order.orderitem_set.all %}
                                <div class="order-item d-flex align-items-center gap-3 p-3">
                                    <img src="{{ item.product.image.url }}" class="order-image rounded" alt="{{ item.product.name }}">
                                    <div class="flex-grow-1">
                                        <div class="fw-bold mb-1">{{ item.product.name }}</div>
                                        <small class="text-muted">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ item.count }}</small>
                                    </div>
                                    <div class="text-nowrap fw-bold">{{ item.price }} ‚ÇΩ</div>
                                </div>
                                {% if not forloop.last %}<hr class="my-2">{% endif %}
                                {% endfor %}
                            </div>
                            <div class="payment-info mt-3 p-3 bg-dark rounded">
                                <strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong> {{ order.payment }}
                            </div>
                        </div>
                    </div>
                  </div>
                </div>

                {% if order.status == '–í –æ–∂–∏–¥–∞–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã' %}
                    <div class="payment-actions">
                        <button class="btn btn-success btn-sm" style="width: 120px">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                    </div>
                {% elif order.status == '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω' %}
                    <div class="payment-actions">
                        <button class="btn btn-outline-light btn-sm" style="width: 120px">–û—Ç—Å–ª–µ–¥–∏—Ç—å</button>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <div class="empty-orders text-center py-5">
            <h3 class="text-muted">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
            <p class="text-muted">–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∫—É–ø–∫–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∑–¥–µ—Å—å —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã</p>
        </div>
    {% endif %}
</section>

{% endblock %}